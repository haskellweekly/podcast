version: v1.0
name: Build pipeline
agent:
  machine:
    type: e1-standard-2
  containers:
    - name: main
      image: semaphoreci/haskell:8.6.5
blocks:
  - name: Build block
    task:
      jobs:
        - name: Build job
          commands:
            - checkout
            - cabal v2-update
            - cabal v2-build
            - env ROOT_URL=https://haskellweekly.news/podcast/ cabal v2-exec podcast
            - cache store "output-$SEMAPHORE_GIT_SHA" output
promotions:
  - name: Deploy promotion
    pipeline_file: deploy.yml
    auto_promote_on:
      - result: passed
        branch:
          - master
